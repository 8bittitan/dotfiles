#!/usr/bin/env zsh
set -euo pipefail

if [ ! -d "$HOME/.local/bin" ]; then
  mkdir -p "$HOME/.local/bin"
fi

# Install homebrew
if [ ! -d "/opt/homebrew" ]; then
	/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

# Install ohmyzsh
if [ ! -d "$HOME/.oh-my-zsh" ]; then
	sh -c "$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
fi

# Install mise
if [ ! -d "$HOME/.local/bin/mise" ]; then
  curl https://mise.jdx.dev/install.sh | sh
fi

"$HOME/.local/bin/mise" activate -s zsh

mise install

if [ ! -d "/opt/homebrew/bin/stow" ]; then
	brew install stow
fi

stow .

# Install brew packages
brew bundle

bat cache --build

$(brew --prefix)/opt/fzf/install

# Install TPM and tmux plugins
git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm

~/.tmux/plugins/tpm/bin/install_plugins

if [ -d "/opt/homebrew/bin/yazi" ]; then
  ya pkg install
fi

if [ -d "/opt/homebrew/bin/gh" ]; then
  gh extension install dlvhdr/gh-dash
fi
